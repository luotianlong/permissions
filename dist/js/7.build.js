webpackJsonp([7],{112:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){return{data:{treeView:[]},config:{deptNameVal:"",searchBox:{searchVal:"",placeholder:"权限名称",suggest:{isShow:1,data:[]}},treeView:{isShow:1,isShowIcon:2,showChoice:!0,choiceConfig:{choiceChild:!0},keyConfig:{name:"MenuName",id:"MenuCode",childKey:"ChildList"},locationConfig:{key:"id"}},modalBox:{isShow:!1,content:"",btn:[{text:"确定",handel:"confirmClick"},{text:"取消",handel:"cancelClick"}]}}}};t.default={data:function(){return new a},activated:function(){var e=this;Bestone.ui.pageInit({setTitle:"权限管理部门配置",reviewCallBack:function(){e.config.deptNameVal=Bestone.util.query().RoleName||"",Bestone.util.ajax({url:"api/AuthManage/GetAllMenus",data:JSON.stringify({Keyword:""}),success:function(t){e.config.searchBox.suggest.data=Bestone.util.getTreeViewDataForSearch({data:t.data||[],name:"MenuName",id:"MenuCode",childKey:"ChildList"}),e.data.treeView=t.data||[],(Bestone.util.query().RoleId||0===Bestone.util.query().RoleId)&&Bestone.util.ajax({url:"api/AuthManage/GetRoleMenus",data:JSON.stringify({RoleId:Bestone.util.query().RoleId}),success:function(t){var n=[];$.each(t.data,function(e,t){$.each(t.ChildList,function(e,t){n.push(t.MenuCode)})}),$.each(e.data.treeView,function(t,a){$.each(a.ChildList,function(a,i){if(n.indexOf(i.MenuCode)>=0){var o=i;o.frontActive=1,e.data.treeView[t].ChildList.splice(a,1,o)}})})}})}})}}),Bestone.ui.ddSetRight({control:!0,text:"保存",show:!0,onSuccess:function(){e.submitConfig()}})},deactivated:function(){var e=this;Bestone.util.resetData(function(){e.data=a().data,e.config=a().config})},methods:{submitConfig:function(){var e=this;if(e.config.deptNameVal.length<=0)return void Bestone.ui.message({content:"部门名称不能为空"});var t="";if($.each(e.data.treeView,function(e,n){$.each(n.ChildList,function(e,n){n.frontActive&&1===n.frontActive&&(t=t+n.MenuCode+",")})}),t.length<=0)return void Bestone.ui.message({content:"请至少选择一个权限"});e.config.modalBox.content='<p style="font-size: 14px;text-align: center;padding: 20px 0px;line-height: 16px;">确定保存配置？</p>',e.config.modalBox.isShow=!0},confirmClickDeal:function(){var e=this;if(e.config.deptNameVal.length<=0)return void Bestone.ui.message({content:"部门名称不能为空"});var t="";if($.each(e.data.treeView,function(e,n){$.each(n.ChildList,function(e,n){n.frontActive&&1===n.frontActive&&(t=t+n.MenuCode+",")})}),t.length<=0)return void Bestone.ui.message({content:"请至少选择一个权限"});t=t.substring(0,t.length-1),Bestone.util.query().RoleId||0===Bestone.util.query().RoleId?Bestone.util.ajax({url:"api/AuthManage/UpdateRole",data:JSON.stringify({Id:Bestone.util.query().RoleId,RoleName:e.config.deptNameVal,MenuCodes:t,OperId:Bestone.user.id,OperName:Bestone.user.name}),success:function(t){Bestone.ui.message({content:"配置成功",notOper:!0}),e.config.modalBox.isShow=!1,setTimeout(function(){window.app.$router.go(-1)},1e3)}}):Bestone.util.ajax({url:"api/AuthManage/AddRole",data:JSON.stringify({RoleName:e.config.deptNameVal,MenuCodes:t,OperId:Bestone.user.id,OperName:Bestone.user.name}),success:function(t){Bestone.ui.message({content:"配置成功",notOper:!0}),e.config.modalBox.isShow=!1,setTimeout(function(){window.app.$router.go(-1)},1e3)}})},cancelClickDeal:function(){this.config.modalBox.isShow=!1},searchClickDeal:function(e){Bestone.ui.message({content:"仅支持智能匹配搜索"})},searchValChangeDeal:function(e){this.config.searchBox.searchVal=e},itemClickDeal:function(e){var t=e.id;if(t){var n=$(".ui.tree-view .loca"+t);$(".ui.tree-view .item").css("background-color","transparent"),n.length>0&&setTimeout(function(){n.css("background-color","#FFFBE6"),$(window).scrollTop(n.offset().top-5)},100)}},dataArrChangeDeal:function(e){this.data.treeView=e}}}},130:function(e,t,n){t=e.exports=n(0)(void 0),t.push([e.i,"#dept-config-detail[data-v-2f1f8b8f]{padding-top:10px;padding-bottom:10px}#dept-config-detail>.dept-name[data-v-2f1f8b8f]{padding:5px 15px;background-color:#fff}#dept-config-detail>.search-content[data-v-2f1f8b8f]{border-top:1px solid #eee;background-color:#fff;padding:10px 15px}#dept-config-detail>.tree-view-content[data-v-2f1f8b8f]{margin-top:10px;border-bottom:1px solid #eee}",""])},163:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{attrs:{id:"dept-config-detail"}},[n("div",{staticClass:"dept-name"},[n("div",{staticClass:"ui ui-input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.config.deptNameVal,expression:"config.deptNameVal"}],attrs:{type:"text",placeholder:"填写部门名称",name:"deptName"},domProps:{value:e.config.deptNameVal},on:{input:function(t){t.target.composing||(e.config.deptNameVal=t.target.value)}}})])]),e._v(" "),""!==e.config.selectChoiceId?n("div",{staticClass:"search-content"},[n("search-box",{attrs:{searchVal:e.config.searchBox.searchVal,placeholder:e.config.searchBox.placeholder,suggest:e.config.searchBox.suggest},on:{searchClick:e.searchClickDeal,searchValChange:e.searchValChangeDeal,itemClick:e.itemClickDeal}})],1):e._e(),e._v(" "),""!==e.config.selectChoiceId?n("div",{staticClass:"tree-view-content"},[n("tree-view",{attrs:{dataArr:e.data.treeView,setConfig:e.config.treeView},on:{dataArrChange:e.dataArrChangeDeal}})],1):e._e(),e._v(" "),e._e(),e._v(" "),n("modal-box",{attrs:{setConfig:e.config.modalBox},on:{confirmClick:e.confirmClickDeal,cancelClick:e.cancelClickDeal}})],1)])},staticRenderFns:[]}},194:function(e,t,n){var a=n(130);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n(2)("6a81cbc0",a,!0)},81:function(e,t,n){function a(e){n(194)}var i=n(1)(n(112),n(163),a,"data-v-2f1f8b8f",null);e.exports=i.exports}});