webpackJsonp([26],{140:function(e,a,t){a=e.exports=t(0)(void 0),a.push([e.i,"#apply-permission[data-v-a2fac676]{padding-top:10px;padding-bottom:10px;font-size:14px;color:#404040}#apply-permission>.choice-permission[data-v-a2fac676]{margin-top:10px}#apply-permission>.choice-permission>.choice-department[data-v-a2fac676],#apply-permission>.search-content[data-v-a2fac676]{padding:10px 15px;background-color:#fff}#apply-permission>.explain-content[data-v-a2fac676]{padding:0 15px}#apply-permission>.tree-view-content[data-v-a2fac676]{margin-top:10px;margin-bottom:10px}#apply-permission>.explain[data-v-a2fac676]{padding:10px 15px;background-color:#fff;margin-top:10px}",""])},173:function(e,a){e.exports={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("div",{attrs:{id:"apply-permission"}},[t("div",{staticClass:"ui ui-text-list"},[e.config.isProxy?e._e():[t("p",[e._v("申请权限账号："+e._s(e.config.userInfo.user))]),e._v(" "),t("p",[e._v("姓名："+e._s(e.config.userInfo.name))]),e._v(" "),t("p",[e._v("账号所属公司："+e._s(e.config.userInfo.branchName))])],e._v(" "),e.config.isProxy?[e._e(),e._v(" "),t("p",[e._v("申请人："+e._s(e.config.proxyUserInfo.name))]),e._v(" "),t("p",[e._v("代办人："+e._s(e.config.userInfo.name))])]:e._e()],2),e._v(" "),t("div",{staticClass:"choice-permission"},[t("div",{staticClass:"ui ui-title"},[e._v("选择权限")]),e._v(" "),t("div",{staticClass:"choice-department"},[t("select-box",{attrs:{defaultVal:e.config.selectBox.defaultVal,dropDownData:e.config.selectBox.dropDownData},on:{selectClick:e.selectClick}})],1)]),e._v(" "),""!==e.config.selectChoiceId?t("div",{staticClass:"explain-content"},[e._m(0)]):e._e(),e._v(" "),""!==e.config.selectChoiceId?t("div",{staticClass:"search-content"},[t("search-box",{attrs:{searchVal:e.config.searchBox.searchVal,placeholder:e.config.searchBox.placeholder,suggest:e.config.searchBox.suggest},on:{searchClick:e.searchClickDeal,searchValChange:e.searchValChangeDeal,itemClick:e.itemClickDeal}})],1):e._e(),e._v(" "),""!==e.config.selectChoiceId?t("div",{staticClass:"tree-view-content"},[t("tree-view",{attrs:{dataArr:e.data.treeView,setConfig:e.config.treeView},on:{addDirect:e.addDirectDeal,addCustom:e.addCustomDeal}}),e._v(" "),e.data.treeView&&e.data.treeView.length<=0?t("div",{staticClass:"ui no-data",staticStyle:{"margin-top":"0px"}},[e._v("暂无数据")]):e._e()],1):e._e(),e._v(" "),t("div",{staticClass:"explain"},[t("div",{staticClass:"ui ui-textarea"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.config.explainValue,expression:"config.explainValue"}],attrs:{placeholder:"申请权限说明（选填）"},domProps:{value:e.config.explainValue},on:{input:function(a){a.target.composing||(e.config.explainValue=a.target.value)}}})])]),e._v(" "),e._e(),e._v(" "),e.config.isProxy&&e.config.tdsLoginShow?t("tds-login-modal",{attrs:{setConfig:e.config.tdsLoginModal},on:{getCode:e.getCodeDeal,submit:e.submitDeal}}):e._e()],1)])},staticRenderFns:[function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"ui ui-icon-explain"},[t("div",{staticClass:"title"},[e._v("图例：")]),e._v(" "),t("ul",[t("li",[t("div",{staticClass:"icon-content",staticStyle:{"background-color":"#E5B626"}},[t("i",{staticClass:"iconfont icon-jia"})]),e._v(" "),t("span",[e._v("按所属公司添加权限范围")])]),e._v(" "),t("li",[t("div",{staticClass:"icon-content",staticStyle:{"background-color":"#22AC38"}},[t("i",{staticClass:"iconfont icon-tubiaozhizuomoban-"})]),e._v(" "),t("span",[e._v("自定义选择权限管理范围")])])])])}]}},204:function(e,a,t){var n=t(140);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);t(2)("65dde49c",n,!0)},61:function(e,a,t){function n(e){t(204)}var o=t(1)(t(92),t(173),n,"data-v-a2fac676",null);e.exports=o.exports},92:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=function(){return{data:{treeView:[]},config:{isProxy:!1,tdsLoginShow:!1,chose:0,msgType:1,userInfo:{user:"",name:"",branchName:""},proxyUserInfo:{user:"",name:""},tdsLoginModal:{getCodeBtnText:"获取短信验证码",submitBtnText:"代为申请权限账号授权",prompt:"",warn:""},selectBox:{defaultVal:"请选择部门权限",dropDownData:[]},searchBox:{searchVal:"",placeholder:"权限名称",suggest:{isShow:1,data:[]}},treeView:{isShow:1,isShowIcon:2,keyConfig:{name:"MenuName",id:"MenuId",childKey:"ChildList"},btn:[{iconFontClass:"icon-tubiaozhizuomoban-",color:"#22AC38",handle:"addCustom"},{iconFontClass:"icon-jia",color:"#E5B626",handle:"addDirect"}],locationConfig:{key:"id"}},selectChoiceId:"",explainValue:""}}};a.default={data:function(){return new n},activated:function(){var e=this;Bestone.ui.pageInit({setTitle:"申请权限",reviewCallBack:function(){e.data=n().data,e.config=n().config,Bestone.util.resetApplyData(),Bestone.util.query().ProxyApply&&(e.config.isProxy=!0,e.config.tdsLoginShow=!0),e.config.userInfo.user=Bestone.user.user,e.config.userInfo.name=Bestone.user.name,e.config.userInfo.branchName=Bestone.user.branchName,Bestone.util.ajax({url:"api/PermissionManage/GetAllRoleGroup",data:JSON.stringify({}),success:function(a){var t=[];$.each(a.data,function(e,a){t.push({id:a.Id,name:a.RoleName})}),e.config.selectBox.dropDownData=t}})}}),Bestone.ui.ddSetRight({control:!0,text:"下一步("+Bestone.applyData.MenuArr.length+")",show:!0,onSuccess:function(){e.submitApply()}}),e.config.chose=Bestone.applyData.MenuArr.length},deactivated:function(){var e=this;Bestone.util.resetData(function(){e.data=n().data,e.config=n().config,Bestone.util.resetApplyData()})},methods:{submitApply:function(){var e=this;if(Bestone.applyData.MenuArr.length<=0)return void Bestone.ui.message({content:"请先选择"});Bestone.applyData.ApplyDesc=e.config.explainValue,Bestone.util.vueJump({path:"/applyPermission/finalCheck"})},getCodeDeal:function(e){var a=this;Bestone.util.ajax({url:"api/DingTalk/SendMessage",data:JSON.stringify({accountName:e,msgType:a.config.msgType,businessType:2}),success:function(e){var t=e.data.PhoneNum,n=t.substr(0,4)+"****"+t.substr(t.length-3,t.length),o="";o=1===a.config.msgType?"文字短信":"语音口令",a.config.tdsLoginModal.prompt="你的手机"+n+"将会收到一条"+o+"，请注意查收！"},fail:function(){a.config.msgType=2,a.config.tdsLoginModal.getCodeBtnText="发送语音口令"}})},submitDeal:function(e){var a=this;Bestone.util.ajax({url:"api/DingTalk/AuthProxy",data:JSON.stringify({accountName:e.accountVal,code:e.verifyCode}),success:function(e){e=e.data,a.config.tdsLoginShow=!1,Bestone.applyData.ProxyApplyUserId=e.UserId,Bestone.applyData.ProxyApplyUserAccount=e.AccountName,Bestone.applyData.ProxyApplyUserName=e.UserName,Bestone.applyData.ProxyApplyBranchId=e.BranchId,Bestone.applyData.ProxyApplyBranchName=e.BranchName,a.config.proxyUserInfo.user=Bestone.applyData.ProxyApplyUserAccount,a.config.proxyUserInfo.name=Bestone.applyData.ProxyApplyUserName}})},selectClick:function(e){var a=this;Bestone.applyData.RoleId=0,Bestone.applyData.MenuArr=[],a.config.chose=Bestone.applyData.MenuArr.length,Bestone.ui.ddSetRight({control:!0,text:"下一步("+Bestone.applyData.MenuArr.length+")",show:!0,onSuccess:function(){a.submitApply()}}),a.config.selectChoiceId=e.id,Bestone.applyData.RoleId=e.id,Bestone.util.ajax({url:"api/AuthManage/GetRoleMenus",data:JSON.stringify({RoleId:a.config.selectChoiceId}),success:function(e){a.config.searchBox.suggest.data=Bestone.util.getTreeViewDataForSearch({data:e.data,name:"MenuName",id:"MenuId",childKey:"ChildList"}),$.each(e.data,function(e,a){a.frontNoShowBtn=["addCustom","addDirect"]}),a.data.treeView=e.data}})},searchClickDeal:function(e){Bestone.ui.message({content:"仅支持智能匹配搜索"})},searchValChangeDeal:function(e){this.config.searchBox.searchVal=e},itemClickDeal:function(e){var a=e.id;if(a){var t=$(".ui.tree-view .loca"+a);$(".ui.tree-view .item").css("background-color","transparent"),t.length>0&&setTimeout(function(){t.css("background-color","#FFFBE6"),$(window).scrollTop(t.offset().top-5)},100)}},addDirectDeal:function(e){var a=this,t=!1,n=0,o="";a.config.isProxy?(n=Bestone.applyData.ProxyApplyBranchId,o=Bestone.applyData.ProxyApplyBranchName):(n=Bestone.user.branchId,o=Bestone.user.branchName);var s={MenuID:e.MenuId,BranchIds:""!==e.MenuBusinessType?[n]:[],ButtonIds:[],MenuName:e.MenuName,BranchNames:""!==e.MenuBusinessType?[o]:[],ButtonNames:[]};$.each(Bestone.applyData.MenuArr,function(a,n){if(n.MenuID==e.MenuId)return Bestone.applyData.MenuArr.splice(a,1,s),t=!0,!1}),t||Bestone.applyData.MenuArr.push(s),a.config.chose=Bestone.applyData.MenuArr.length,Bestone.ui.ddSetRight({control:!0,text:"下一步("+Bestone.applyData.MenuArr.length+")",show:!0,onSuccess:function(){a.submitApply()}}),Bestone.ui.message({content:"添加成功"})},addCustomDeal:function(e){var a=this;if(""!==e.MenuBusinessType)Bestone.util.vueJump({path:"/applyPermission/mgmtLimit",query:{MenuId:e.MenuId,MenuName:e.MenuName,MenuBusinessType:e.MenuBusinessType}});else{var t=!1,n={MenuID:e.MenuId,BranchIds:[],ButtonIds:[],MenuName:e.MenuName,BranchNames:[],ButtonNames:[]};$.each(Bestone.applyData.MenuArr,function(a,o){if(o.MenuID==e.MenuId)return Bestone.applyData.MenuArr.splice(a,1,n),t=!0,!1}),t||Bestone.applyData.MenuArr.push(n),a.config.chose=Bestone.applyData.MenuArr.length,Bestone.ui.ddSetRight({control:!0,text:"下一步("+Bestone.applyData.MenuArr.length+")",show:!0,onSuccess:function(){a.submitApply()}}),Bestone.ui.message({content:"添加成功"})}}}}}});